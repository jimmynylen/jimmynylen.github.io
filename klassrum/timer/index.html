<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Klassrumstimer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Ladda in Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro&display=swap" />
  <style>
    :root {
      --bg: #f4f4f4;
      --white: #ffffff;
      --primary: #40534C;
      --cell_mediumgreen: #3CB371;
      --dark: #1A3636;
      --text: #644117;
      --subtle: #D6BD98;
      --effect: #677D6A;
      --placeholder: #B9AFA1;
      --textarea: #FCF8F4;
      --extra_effect: #D98E04;
      --extra_primary: #E0A030;
      --extra_red: #A44434;
      --status_graygreen: #8E9775;
      --status_olivegreen: #5B7052;
      --status_ochreyellow: #D4A76A;
      --status_goldenbrown: #C2955C;
      --status_sienna: #A0522D;
      --status_burntumber: #8A3324;
      --status_steelblue: #4682B4;
      --status_darkblue:  #2C3E50;
      --status_softlavendel: #A7A0C9;
      --status_mutedpurple:  #6B5876;
      
      /* Klockans färger */
      --clock-border: #1A3636;
      --clock-bg: #FCF8F4;
      --clock-digit: #1A3636;
      --clock-hand: #2C3E50;
      --clock-second-hand: #A44434;
      --clock-border-width: 0.05;

      /* Timer-specifika variabler */
      --timer-font-family: sans-serif;
      --timer-font-size: 52px;
      --timer-font-weight: 400;
      --timer-font-color: var(--dark);
      --timer-bg: #FCF8F4;
      --timer-border: #1A3636;
      --timer-progress-color: #F7E7CE;
      --timer-text-shadow: 0px 0px 2px rgba(250, 250, 250, 0.9);
    }
    
    * { box-sizing: border-box; }
    
    body {
      font-family: 'Source Serif Pro', serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg);
    }
    
    .container {
      max-width: 740px;
      margin: 20px auto;
      padding: 20px;
      background-color: var(--white);
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      font-size: 24px;
      color: var(--white);
      background-color: var(--primary);
      border-radius: 8px 8px 0 0;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    textarea {
      background-color: var(--textarea);
      border: 1px solid var(--effect);
      color: var(--dark);
      font-size: 13px;
      width: 100%;
      max-width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 5px;
      border-radius: 5px;
      box-sizing: border-box;
      resize: vertical;
    }
    
    .inforuta {
      margin-top: 0;
      font-size: 15px;
      color: var(--text);
      background-color: var(--subtle);
      border-radius: 0 0 8px 8px;
      padding: 10px 20px;
      margin-bottom: 15px;
    }
    
    .game-area {
      display: flex;
      gap: 15px;
      background-color: var(--effect);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid var(--primary);
    }
    
    .box {
      flex: 1 1 50%;
      background-color: var(--primary);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      color: var(--dark);
      position: relative;
    }
    
    /* Timercirkeldiagram och centrerat innehåll */
    #timer-container {
      position: relative;
      width: 250px;
      height: 250px;
      margin: 0 auto;
    }
    
    #timer-canvas {
      display: block;
      margin: 0 auto;
    }
    
    /* Container för timervisning och knappar */
    #timer-info {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    /* Numerisk timer – tar sin naturliga plats i flexboxen */
    #timer-display {
      font-size: var(--timer-font-size);
      font-family: var(--timer-font-family);
      font-weight: var(--timer-font-weight);
      color: var(--timer-font-color);
      text-shadow: var(--timer-text-shadow);
      outline: none;
      cursor: text;
      height: 52px;
      line-height: 52px;
    }
    
    /* Knapparna, staplade vertikalt med 5px gap */
    #timer-controls {
      display: flex;
      flex-direction: column;
      gap: 0px;
      height: 52px;
      margin-top:10px;
    }
    
    #timer-controls button {
      padding: 0;
      margin: 0;
      background: none;
      border: none;
      cursor: pointer;
      /* Varje knapp får höjden: (52px - 5px) / 2 */
      height: calc((52px - 10px) / 2);
    }
    
    /* Ändra Material Icons färg till grön */
    .material-icons {
      color: #40534C;
    }
    
    /* Analog klocka */
    #clock-box {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    #clock-box canvas {
      display: block;
      width: 250px;
      height: 250px;
    }
    
    #add-info-btn {
      display: block;
      width: 200px;
      margin: 0 auto 15px auto;
      padding: 10px 20px;
      font-size: 16px;
      background-color: var(--primary);
      color: var(--white);
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    #add-info-btn:hover {
      background-color: var(--effect);
    }

  </style>
</head>
<body>
  <div class="container">
    <h1>Klassrumstimer</h1>
    <p class="inforuta">
      En enkel timer och klocka för visning på projektor under lektioner. Det är också möjligt att visa annan information som kan vara viktig för lektionen eller provet, såsom provkoder till digitala plattformar eller instruktioner för den pågående uppgiften.
    </p>
    
    <div class="game-area">
      <div id="timer-box" class="box">
        <div id="timer-container">
          <canvas id="timer-canvas" width="250" height="250"></canvas>
          <div id="timer-info">
            <span id="timer-display" contentEditable="true">60:00</span>
            <div id="timer-controls">
              <button id="toggle-btn"><i class="material-icons">play_arrow</i></button>
              <button id="stop-btn"><i class="material-icons">stop</i></button>
            </div>
          </div>
        </div>
      </div>
      <div id="clock-box" class="box">
        <canvas id="clock-canvas" width="250" height="250"></canvas>
      </div>
    </div>
    
    <button id="add-info-btn">Lägg till ny ruta</button>
    <div id="info-container"></div>
  </div>
  
  <script>
    // Hjälpfunktion för att parsa en tidsträng (mm:ss) till sekunder
    function parseTimeString(timeStr) {
      const parts = timeStr.split(':');
      if (parts.length === 2) {
        const minutes = parseInt(parts[0], 10);
        const seconds = parseInt(parts[1], 10);
        if (!isNaN(minutes) && !isNaN(seconds)) {
          return minutes * 60 + seconds;
        }
      }
      return null;
    }
    
    // Formatera sekunder till mm:ss
    function formatTime(totalSeconds) {
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      return (minutes < 10 ? "0" + minutes : minutes) + ":" +
             (seconds < 10 ? "0" + seconds : seconds);
    }
    
    const timerDisplayElem = document.getElementById("timer-display");
    let timerDuration = parseTimeString(timerDisplayElem.textContent) || 3600;
    let timeLeft = timerDuration;
    let timerInterval = null;
    let isTimerRunning = false;
    
    // Uppdatera visningen och cirkeldiagrammet
    function updateTimerDisplay() {
      timerDisplayElem.textContent = formatTime(timeLeft);
      updateTimerCanvas();
    }
    
    // När användaren redigerar timervisningen uppdateras värdet vid blur
    timerDisplayElem.addEventListener("blur", function() {
      const newTime = parseTimeString(timerDisplayElem.textContent);
      if (newTime !== null && newTime > 0) {
        timerDuration = newTime;
        timeLeft = timerDuration;
        updateTimerDisplay();
      } else {
        timerDisplayElem.textContent = formatTime(timeLeft);
      }
    });
    
    // Toggle-knapp för att starta/pausa timern
    document.getElementById("toggle-btn").addEventListener("click", function() {
      const toggleBtnIcon = this.querySelector("i");
      if (!isTimerRunning) {
        timerDisplayElem.contentEditable = false;
        timerInterval = setInterval(function() {
          if (timeLeft > 0) {
            timeLeft--;
            updateTimerDisplay();
          } else {
            clearInterval(timerInterval);
            isTimerRunning = false;
            timerDisplayElem.contentEditable = true;
            toggleBtnIcon.textContent = "play_arrow";
          }
        }, 1000);
        isTimerRunning = true;
        toggleBtnIcon.textContent = "pause";
      } else {
        clearInterval(timerInterval);
        isTimerRunning = false;
        timerDisplayElem.contentEditable = true;
        toggleBtnIcon.textContent = "play_arrow";
      }
    });
    
    // Stop-knappen återställer timern
    document.getElementById("stop-btn").addEventListener("click", function() {
      clearInterval(timerInterval);
      isTimerRunning = false;
      timeLeft = timerDuration;
      updateTimerDisplay();
      timerDisplayElem.contentEditable = true;
      document.querySelector("#toggle-btn i").textContent = "play_arrow";
    });
    
    updateTimerDisplay();
    
    // Uppdatera cirkeldiagrammet för timern
    function updateTimerCanvas() {
      const canvas = document.getElementById("timer-canvas");
      const ctx = canvas.getContext("2d");
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) * 0.90;
      
      const rootStyles = getComputedStyle(document.documentElement);
      const timerBg = rootStyles.getPropertyValue('--timer-bg').trim();
      const timerBorder = rootStyles.getPropertyValue('--timer-border').trim();
      const borderRatio = parseFloat(rootStyles.getPropertyValue('--clock-border-width')) || 0.05;
      const borderThickness = radius * borderRatio;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Rita bakgrunden
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
      ctx.fillStyle = timerBg;
      ctx.fill();
      
      // Rita framsteg (fyllning)
      let progress = (timerDuration - timeLeft) / timerDuration;
      let startAngle = -Math.PI / 2;
      let endAngle = startAngle + progress * 2 * Math.PI;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, startAngle, endAngle, false);
      ctx.closePath();
      ctx.fillStyle = rootStyles.getPropertyValue('--timer-progress-color').trim();
      ctx.fill();
      
      // Rita cirkelns kant
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
      ctx.strokeStyle = timerBorder;
      ctx.lineWidth = borderThickness;
      ctx.stroke();
    }
    
    // Analog klocka
    function drawClock() {
      const canvas = document.getElementById("clock-canvas");
      const ctx = canvas.getContext("2d");
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) * 0.90;
      
      const rootStyles = getComputedStyle(document.documentElement);
      const clockBg = rootStyles.getPropertyValue('--clock-bg').trim();
      const clockBorder = rootStyles.getPropertyValue('--clock-border').trim();
      const clockBorderWidth = parseFloat(rootStyles.getPropertyValue('--clock-border-width')) || 0.05;
      const clockDigit = rootStyles.getPropertyValue('--clock-digit').trim();
      const clockHand = rootStyles.getPropertyValue('--clock-hand').trim();
      const clockSecondHand = rootStyles.getPropertyValue('--clock-second-hand').trim();
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Rita klockans bakgrund och kant
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
      ctx.fillStyle = clockBg;
      ctx.fill();
      ctx.strokeStyle = clockBorder;
      ctx.lineWidth = radius * clockBorderWidth;
      ctx.stroke();
      
      // Rita siffror
      ctx.fillStyle = clockDigit;
      ctx.font = (radius * 0.15) + "px sans-serif";
      ctx.textBaseline = "middle";
      ctx.textAlign = "center";
      for (let num = 1; num <= 12; num++) {
        let ang = num * Math.PI / 6;
        let numX = centerX + radius * 0.75 * Math.cos(ang - Math.PI/2);
        let numY = centerY + radius * 0.75 * Math.sin(ang - Math.PI/2);
        ctx.fillText(num.toString(), numX, numY);
      }
      
      // Rita klockans visare
      let now = new Date();
      let hour = now.getHours() % 12;
      let minute = now.getMinutes();
      let second = now.getSeconds();
      let hourAngle = (hour * Math.PI / 6) + (minute * Math.PI / 360) + (second * Math.PI / 21600);
      drawHand(ctx, centerX, centerY, hourAngle, radius * 0.5, radius * 0.07, clockHand);
      let minuteAngle = (minute * Math.PI / 30) + (second * Math.PI / 1800);
      drawHand(ctx, centerX, centerY, minuteAngle, radius * 0.7, radius * 0.05, clockHand);
      let secondAngle = second * Math.PI / 30;
      drawHand(ctx, centerX, centerY, secondAngle, radius * 0.8, radius * 0.02, clockSecondHand);
    }
    
    function drawHand(ctx, x, y, pos, length, width, color) {
      ctx.beginPath();
      ctx.lineWidth = width;
      ctx.lineCap = "round";
      ctx.strokeStyle = color || "#40534C";
      ctx.moveTo(x, y);
      ctx.lineTo(x + length * Math.cos(pos - Math.PI/2), y + length * Math.sin(pos - Math.PI/2));
      ctx.stroke();
    }
    
    setInterval(drawClock, 1000);
    drawClock();
    
    document.getElementById("add-info-btn").addEventListener("click", function() {
      const infoContainer = document.getElementById("info-container");
      const newInfo = document.createElement("div");
      newInfo.className = "inforuta";
      newInfo.contentEditable = "true";
      newInfo.textContent = "Skriv här...";
      infoContainer.appendChild(newInfo);
    });
  </script>
</body>
</html>
